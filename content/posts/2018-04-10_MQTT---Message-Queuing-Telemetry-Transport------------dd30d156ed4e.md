---
title: MQTT — Message Queuing Telemetry Transport (සිංහලෙන්)
description: >-
  අද කතා කරන්න යන්නෙ තරමක් වෙනස් මාතෘකාවක් ගැන. අපි හැමෝම HTTP හෙවත් Hyper Text
  Transfer Protocol එක භාවිතා කරලා තියනවනෙ. මේ අවස්ථාවෙ ඔබ මේක…
date: '2018-04-10T13:21:49.480Z'
draft: true
categories: []
keywords: []
slug: >-
  /@kasvith/mqtt-message-queuing-telemetry-transport-%E0%B7%83%E0%B7%92%E0%B6%82%E0%B7%84%E0%B6%BD%E0%B7%99%E0%B6%B1%E0%B7%8A-dd30d156ed4e
---

අද කතා කරන්න යන්නෙ තරමක් වෙනස් මාතෘකාවක් ගැන. අපි හැමෝම HTTP හෙවත් Hyper Text Transfer Protocol එක භාවිතා කරලා තියනවනෙ. මේ අවස්ථාවෙ ඔබ මේක කියවන browser එකේ URL එකට කලින් තියන http:// හෝ https:// කියන දෙකෙන් අර්ථගැන්වෙන්නෙ මේ ඔබ සම්භන්ධ වෙලා ඉන්නෙ http connection එකකින් කියල. S අකුර තියනවනම් ඒක ආරක්ශිත Secured connection එකක්. ඉතින් ඒ වගේම තවත් Protocol එකක් ගැන තමා කියල දෙන්න යන්නෙ.

![MQTT Workflow](img/0__RWiD73zyPv____8n7q.png)
MQTT Workflow

### Protocol එකක් කියන්නෙ මොකක්ද ?

සරලම භාශාවෙන් කීවොත් මේක Communication Procedure එකක්. අපි ලියුමක් ලියලා ලියුම් පෙට්ටියට දැම්මම තැපැල් දෙපාර්තමේන්තුවෙන් ලියුම අරගෙන අදාල පුද්ගලයට යවනවා. ඉතින් මේ ලිපියේ මුද්දර නැත්නම් මොකද වෙන්නෙ? ලියුම යවපු කෙනාටම ලැබෙනව. අදාල කෙනාට ලියුම යැව්වමද නැද්ද හරියටම තහවරු කරගන්න ඔබට ඕන නම් පුලුවන් ලියාපදිංචි තැපෑල භාවිතා කරන්න. එවිට ලබන්නාගෙන් අත්සනක් ගන්නවා මේක ලැබුණු බව තහවරු කරගන්න. මේක සන්නිවේදනය කරන නිශ්චිත ක්‍රියාපටිපාටියක්. අදාල පියවරයන් සමත් වෙනවනම් පණිවුඩය යනවා නිවරදිව.

### එතකොට ඒක හරියි කියමු. අර කීව HTTPත් ඔය වගේ ද?

ඔව් මේකත් ලියුමක් දාලා යැව්වා වගේ තමා. මේ protocol එක නිපදවන්නෙ අන්තර්ජාලය තුල ලේඛණ හුවමාරු කරගන්න සුදුසු විදියට. ඔබට කිසියම් වාක්‍ය පෙලක් සමඟ ඡායාරූපයක් වගේ දේවල් යවන්න හැකියාව තිබෙනව මේකෙදි. මෙතන Hyper Text කියන්නෙ කිසියම් structure එකක් භාවිතා කරන්නා කිසියම් document එකක්. 1989 HTTP ලොවට හඳුන්වාදෙන්නෙ ශ්‍රීමත් ටිම් බර්නස් ලී විසින්. මේක ගැන තවදුරටත් කියනවනම් Request/Response architecture එකට තමා හදලා තියෙන්නෙ. ඒ කියන්නෙ ඉල්ලුවොත් ලැබෙන ක්‍රමවේදයක්. Requests යවන්නෙ සාමාන්‍යෙන් Server පරිගණකයකට. එතනදි අදාල resources එක තිබේ නම් Response එකේදි ඒක ඉල්ලපු කෙනාට (Client) ට ලැබෙනව. මේ කියන Tim තමා HTTP වල ලිපි හුවමාරු කරන්න Hyper Text Markup Language හෙවත් HTML ලොවට හදුන්වාදෙන්නෙ.

### හරි එතකොට මොකක්ද MQTT කියන්නෙ?

මුලින්ම අපි මේකෙත් ඉතිහාසය පැත්තට යොමුවෙමු,  
1999 දී Dr Andy Stanford-Clark සහ Arlen Nipper කියන දෙපලට ව්‍යාපෘතියක් ලැබෙනවා තෙල් නල පාලනය සහ monitor කිරීම සඳහා උපකරණ නිපදවන්න. ඒ කාලෙ 4g එහෙම තිබ්බෙ නෑ නෙ. අනික කාන්තාර මැද්දෙ අදටත් ඉතින් signal නෑ නෙ. ඔවුන් දෙදෙනා තීරණය කලේ සැටලයිට් හරහා මෙම උපකරන වලින් දත්ත ලබා ගැනීමටත් එම දත්ත monitor කිරීමටත් පද්ධතියක් නිපදවන්න. එම කාලය වන විටත් බොහෝ protocol තිබුණා http ට අමතරව. ගැටලුවක් නෑ ප්‍රශ්නයක් කරගන්න එපා කියල අපි කිව්වට මේවා භාවිතා කරද්දි බැටරි බහිනව පුදුම විදියට, ඊට පස්සෙ කාන්තාරෙ යන්න වෙනවා සතියෙන් සතිය බැටරි දාන්න…ඔය අස්සෙ කොරේ පිටට මරේ කියල තිබ්බ තවත් ප්‍රශ්නයක් තමා Sattelite Links වල තිබ්බ අස්ථාවර බව. බොහොම අමාරුවෙන් තමා සන්නිවේදනය කරන්න වෙන්නෙ.   
ඉතින් මේ ප්‍රශ්න ගැන හිතලා දෙන්නා පටන්ගන්නවා අලුතෙන් Protocol එකක් හදන්න. මේක ඉතාම සුළු විදුලි ප්‍රමාණයක් පරිභෝජනය කරන්න ඕන වගේම අස්ථාවර සැටලයිට් සම්භන්ධතා හරහා නූලෙන් හරි සම්බන්ධය පවත්වාගන්න ඕන. ඉතින් ඔය ප්‍රශ්නෙට විසදූමක් ලෙස තමා ඔවුන් මේ MQTT හදුන්වාදෙන්නෙ. මේක ඉතාම අඩු resources යටතේ වැඩ කරන, ඉතාම අඩු data ප්‍රමාණයක් වැය කරන සරල protocol එකක්.

### MQTT වල තතු

මම මුලින්ම කීවා HTTP වලදි අපි කලේ Server පරිගණකයකින් කිසියම් Document එකක් request කරලා එම resource එක තිබේ නම් එය Server එක විසින් Client ට ලබාදෙනව කියලනෙ.  
MQTT වලදි මේක ටිකක් වෙනස් විදියටයි යන්නෙ.   
MQTT වලදි සියළුම සන්නිවේදනයන් යන්නෙ MQTT Broker එක හරහා. මේක ටිකක් වෙනස් server එකක් ලෙස දුටුවට වරදක් නෑ.  
HTTP වලදි සියල්ල සිදුවෙන්නෙ resource හරහා. MQTT වලදි මේක වෙන්නෙ Publish/Subscribe හරහා

### මොකක්ද ඒ කිව්වෙ ?

මෙහෙමයි, හිතන්න දැන් ඔබේ යහලුවා ක්‍රිකට් තරඟයක් නරඹනවා කියල. ඔබට වෙන වැඩක් තියනවා ඒ අතරෙ කරන්න. ඔබ ඉතින් යාළුවට කියනවා. “මචන් මට පොඩ්ඩක් තත්වෙ කියපන්, මොකක් හරි සුපිරි තැනක් ආවොත් අනිවා කියපන්” කියලා. ඉතින් ඔබේ යහලුවත් මේකට එකඟ වෙලා මිනිහා මැච් එක නරඹනවා. ඉතින් ඔන්න ටිකකින් විකට් එකක් ගියාලු. යාලුවා ඔබට කෑ ගහනවා “මචන් විකට් එකක් ගියෝ….” කියල. ඉතින් ඔබත් කරපු වැඩේ පැත්තකට දාලා ටීවි එක ගාවට එනවා. ඊට පස්සෙ ආයෙත් යනව. නැවත මොකක් හරි වුනාම යාළුවා ආයෙත් ඔබට දැනුම් දෙනවා.  
පොඩ්ඩක් බැලුවොත්….ඔබ යහලුවගෙ විස්තර විචාරයේ Subscriber කෙනෙක් කීවට වරදක් නෑ. යහළුවා විස්තර publish කරන කෙනෙක්. ඒ කියන්නෙ publisher කෙනෙක්.

මෙන්න මේ MQTT වැඩ කරන්නෙත් ඔය වගේ. ඔබට publish/subscribe වෙන්න පුලුවන් Topics වලට. මේ topics handle කරන්නෙ MQTT Broker එක. ඔබ මේ topic එහෙකට subscribe වෙලා ඉන්නවනම්….කිසියම් කෙනෙක් එයට publish කරන විට ඔබටත් එම දත්ත ලැබෙන්න ගන්නවා. ඔබේ ක්‍රිකට් විචාරක යහලුවා MQTT Broker එක ලෙස හිතුවනම් හරි.

MQTT Messages වල ඉතාම අඩු overhead එකක් තමා තියෙන්නෙ. අවශ්‍යම දත්ත පමණයි මේකෙ තියාගන්න හදන්නෙ. අපි දන්නවනේ මේක හදපු දෙන්නට තිබ්බ ප්‍රශ්නෙ Data කියල. සටලයිට් සන්නිවේදනය නිසා ඉතාම අඩු දත්ත ප්‍රමාණයක් යොදාගන්න ඕන වුනා සහ අවම bandwidth එකක් යොදාගන්න උවමනා වුනා. ඉතින් මේ protocol එකේ security features implement කරලා නෑ එයින් අනවශ්‍ය overhead එකක් එන නිසා.

### MQTT Broker එකක කාර්යභාරය

MQTT Topic එකක් ගත්තොත් එය මෙන්න මේ ආකාරයටයි දිස්වන්නෙ   
house/livingroom/temperature   
house/livingroom/humidity   
house/room/1/temperature/sensor1

සමහර වෙලාවට මේවට data යවනකොට network problem නිසා හරියට යවාගන්න බැරිවෙන්න පුලුවන්. ඉතින් mqtt broker ට මේ data packet එක කොහොම හරි ලැබුනම, subscriber නොහිටියොත් මොකක්ද කරන්නෙ? broker මේක ගබඩා කරගෙන නැවත subscriber කෙනෙක් ආවම මේ දත්ත ලබාදෙනවා. මේක QoS හෙවත් Quality of Service කියන protocol එකේම තියන තවත් අංගයක්, Messages හරියට යවන්න ඕන කොහොමද කියල අපිට මේකෙන් දෙන්න පුලුවන්

**QoS 0** — At Most Once (Fire and Forget)   
මෙතනදි message එක publish කරනවා විතරයි. මේකෙදි subscriber ට message එක යවනවාමයි කියල තහවරු කරන්නෙ නෑ

![QoS 0 - HiveMQ Images](img/0__zsyIu2MhzKY58KFy.png)
QoS 0 - HiveMQ Images

**Qos 1** — At least once  
මෙතනදි අඩුම තරමේ එකවරක් subscriber ට message එක යවන්න උත්සහ කරනවා. සමහර විට එක් වරකට වඩා ලැබෙන්නත් ඉඩ තියෙනව. Receiver ට deliver වෙනකම් යවපු කෙනා තියාගෙන ඉන්නව. එතනදි Receiver එකෙන් sender ට acknowledgement එකක් එවනවා හරියට communication එක success වුනා කියල.   
එවිට ඔහු පෙර message එක තබාගන්නෙ නෑ. මෙහිදී සාර්ථක වූවානම් PUBACK කියන command එක තමා ලැබෙන්නෙ.   
PUBACK ලැබුණෙ නැත්නම් කිසියම් කාලයක් ගතවනවිට, නැවත message එක Receiver ට යවනවා.

![QoS 1 — HiveMQ Images](img/0__C8nCspZK7__ZZyVIU.png)
QoS 1 — HiveMQ Images

**QoS 2** — **Exactly Once**  
මේකෙදි වෙන්නෙ PUBACK ට අමතරව තවත් ක්‍රමයක් භාවිතයෙන් හරියටම එක වතාවක් message එක ගියාද බලන එක.   
මුලින්ම PUBLISH කරාම, Receiver ට ලැබුනානම් ඔහු PUBREC (publish received) යවනවා sender ට, එහිදී Receiver ලැබුණු data packet එක තබා ගන්නවා reference එකක් ලෙස. දැන් PUBREC ලැබුනම sender දැනගන්නවා හරියට transmission වෙලා කියලා.   
දැන් ඔහු Receiver ට යවනවා PUBREL (publish released).   
දැන් sender ට sure නිසා කලින් යැව්ව data packet එක safely discard කරන්න පුලුවන්.   
Receiver ට PUBREL ලැබුනම ඔහුත් කලින් තිබුන reference එක අයින් කරගෙන PUBCOMP (publish completed) කියල sender ට යවනව. දැන් දෙපැත්තම දන්නවා වැඩේ වෙලා කියලා

අපිට මේ QoS Levels වලට publish/subscribe වෙන්න පුලුවන්  
මෙතන expencive ම එක තමා QoS 2

![QoS 2 — HiveMQ Images](img/0__wIWzJjHwGvIf2sir.png)
QoS 2 — HiveMQ Images

### හරි එතකොට Security ගැන මොකද?

මේක protocol එකට implement කරල නැත්තේ අනවශ්‍ය overhead එක නිසා. නමුත් TLS(Transport Layer Security) යොදාගන්න පුලුවන් protocol එකෙන් ස්වායක්තව.   
තවද devices හදුනාගන්න authorization කරන්න පුලුවන් broker එක තුල. username/password,Security Keys වගේ දේවල් යොදාගන්න පුලුවන්.

### MQTT වලට තියෙන Port එක මොකක්ද?

සම්මතය තමා TCP/IP 1883 කියන එක භාවිතය.  
SSL වලට TCP/IP 8883 එකත් සම්මත වෙලා තියනව

### MQTT Brokers මොනාද සාමාන්‍යේන්?

\- Ecliplse Mosquitto  
\- Mosca  
\- HiveMQ  
සහ තව public brokers තියනවා

~ කසුන් විතානගේ ([Kasun Vithanage](https://medium.com/u/a8e4cf7d39a1))